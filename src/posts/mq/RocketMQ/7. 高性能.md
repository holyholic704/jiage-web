---
date: 2024-07-01
category:
  - 消息队列
tag:
  - RocketMQ
excerpt: 死信队列的简单介绍
order: 6
---

# 高性能

## 批量发送消息

RocketMQ 支持批量发送消息，可以减少网络通信次数，提高传输效率

- 每条消息的 Topic 必须都得是一样的
- 不支持延迟消息和事务消息
- 不论是普通消息还是批量消息，默认总大小不能超过 4 M

## 消息压缩

RocketMQ 在发送消息，发现消息大小超过 4 K，就会对消息进行压缩，减少存储空间占用，减轻网络传输的压力，但压缩和解压都需要消耗 CPU 资源

- 批量消息不会被压缩

Broker 收到压缩后的消息，并不会直接解压，而是直接将压缩消息刷新到磁盘上，消费者获取到消息才会进行解压，也就是说在生产者压缩，在消费者解压

## 高性能网络通信模型

RocketMQ 的 RPC 通信采用 Netty 组件作为底层通信库，遵循了 Reactor 多线程模型，同时又在这之上做了一些扩展和优化

## 零拷贝（Zero-Copy）

零拷贝是一种高效的数据传输技术，它可以将数据从内核空间直接传输到应用程序的内存空间中

传统的数据传输过程通常需要经历多次内存拷贝。首先，从磁盘读取数据，然后将数据从内核空间拷贝到用户空间，再从用户空间拷贝到应用程序的内存中。这些额外的拷贝会消耗大量的 CPU 资源和内存带宽，降低数据传输的效率。零拷贝就是为了避免这些不必要的数据拷贝，能够将数据直接传输到目标内存区域，以提高数据传输的效率

RocketMQ 使用到了 mmap 和 sendfile 的方式来实现零拷贝

## 顺序写

RocketMQ 会将消息按照顺序一条一条地写入文件中，减少了磁头的移动和寻道时间，顺序写比随机写的性能会高很多

- 使用 SSD 的话，顺序写与随机写差距就不是很大了

## 页缓存（PageCache）

## 异步处理

RocketMQ 在处理消息时，会采用一些异步操作来优化操作时间，例如异步刷盘、异步主从复制

## 参考

- [RocketMQ为什么这么快？我从源码中扒出了10大原因！](https://mp.weixin.qq.com/s/y1-A-SHAkGdg9IOTeUtPxg)
