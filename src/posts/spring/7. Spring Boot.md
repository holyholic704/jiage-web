---
date: 2024-06-20
category:
  - æ¡†æ¶
tag:
  - Spring
  - Spring Boot
excerpt: Spring Boot æ¦‚è¿°
order: 7
---

# Spring Boot

SpringBoot æ˜¯ä¸€ä¸ªå¼€æºçš„æ¡†æ¶ï¼Œæ—¨åœ¨ç®€åŒ– Spring åº”ç”¨çš„åˆå§‹åŒ–å’Œå¼€å‘è¿‡ç¨‹ã€‚ä¸ä»…ç»§æ‰¿äº† Spring æ¡†æ¶åŸæœ‰çš„ä¼˜ç§€ç‰¹æ€§ï¼Œè€Œä¸”è¿˜é€šè¿‡ **çº¦å®šä¼˜äºé…ç½®** çš„æ–¹å¼ç®€åŒ–äº† Spring åº”ç”¨çš„å¼€å‘

![](./md.assets/spring_vs_springboot.gif)

<small>[Spring vs Spring Boot](https://devrant.com/rants/1867059/spring-vs-spring-boot)</small>

> Spring ç®€åŒ– Java åº”ç”¨çš„å¼€å‘ï¼ŒSpring Boot ç®€åŒ– Spring å¼€å‘

## ä¼˜ç‚¹

- å¿«é€Ÿæ„å»ºåº”ç”¨ã€ç®€åŒ–å¼€å‘æµç¨‹ï¼šä¸éœ€è¦ç¼–å†™å¤§é‡æ ·æ¿ä»£ç ã€XML é…ç½®ç­‰
- **éµå¾ªçº¦å®šä¼˜äºé…ç½®**
- **è‡ªåŠ¨åŒ–é…ç½®**ï¼šå¯ä»¥æ ¹æ®æ·»åŠ çš„ä¾èµ–è‡ªåŠ¨é…ç½®é¡¹ç›®ï¼Œçœå»äº†å¤§é‡æ‰‹åŠ¨é…ç½®çš„æ—¶é—´
- **å†…åµŒäº† HTTP æœåŠ¡å™¨**ï¼ˆTomcatã€Jettyï¼‰ï¼Œå¯ä»¥è½»æ¾åœ°å¼€å‘å’Œæµ‹è¯• Web åº”ç”¨ç¨‹åº
- å†…ç½®äº†ç›‘æ§å’Œå¥åº·æ£€æŸ¥åŠŸèƒ½
- ç®€åŒ– Maven é…ç½®ï¼šå¼•å…¥ starter æ—¶ï¼Œä¼šè‡ªåŠ¨å¼•å…¥å…¶ä»–æ‰€éœ€çš„ä¾èµ–ï¼Œè€Œä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨çš„ä¸€ä¸ªä¸ªæ·»åŠ 

## çº¦å®šä¼˜äºé…ç½®

çº¦å®šä¼˜äºé…ç½®æ˜¯ä¸€ç§è½¯ä»¶è®¾è®¡èŒƒå¼ï¼Œåœ¨å‡å°‘è½¯ä»¶å¼€å‘äººå‘˜éœ€åšå†³å®šçš„æ•°é‡ï¼Œå¼€å‘äººå‘˜ä»…éœ€è§„å®šåº”ç”¨ä¸­ä¸ç¬¦åˆçº¦å®šçš„éƒ¨åˆ†

ä¾‹å¦‚ Spring Boot ä¼šé»˜è®¤åŠ è½½ application å‘½åçš„ yaml æˆ– properties æ–‡ä»¶ï¼Œä½†ä½ ä¹Ÿå¯ä»¥é…ç½®å¤šä¸ªé…ç½®æ–‡ä»¶ï¼Œé€šè¿‡ `spring.profiles.active` å‚æ•°åˆ‡æ¢

## æ ¸å¿ƒæ³¨è§£

### `@SpringBootApplication`

ç”¨åœ¨å¯åŠ¨ç±»ä¸Š

```java
@SpringBootApplication
public class TestApplication {

    public static void main(String[] args) {
        SpringApplication.run(TestApplication.class, args);
    }

}
```

`@SpringBootApplication` å…¶å®å°±æ˜¯ `@SpringBootConfiguration`ã€`@EnableAutoConfiguration`ã€`@ComponentScan` çš„ç»„åˆ

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@SpringBootConfiguration
@EnableAutoConfiguration
@ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),
        @Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })
public @interface SpringBootApplication {

    @AliasFor(annotation = EnableAutoConfiguration.class)
    Class<?>[] exclude() default {};

    @AliasFor(annotation = EnableAutoConfiguration.class)
    String[] excludeName() default {};

    @AliasFor(annotation = ComponentScan.class, attribute = "basePackages")
    String[] scanBasePackages() default {};

    @AliasFor(annotation = ComponentScan.class, attribute = "basePackageClasses")
    Class<?>[] scanBasePackageClasses() default {};

    @AliasFor(annotation = ComponentScan.class, attribute = "nameGenerator")
    Class<? extends BeanNameGenerator> nameGenerator() default BeanNameGenerator.class;

    @AliasFor(annotation = Configuration.class)
    boolean proxyBeanMethods() default true;
}
```

### `@SpringBootConfiguration`

è¡¨ç¤ºå½“å‰ç±»æ˜¯ä¸€ä¸ª Spring é…ç½®ç±»ï¼Œä»–çš„æ ¸å¿ƒå…¶å®æ˜¯ `@Configuration`

```java
@Target({ElementType.TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Configuration
@Indexed
public @interface SpringBootConfiguration {
    @AliasFor(
        annotation = Configuration.class
    )
    boolean proxyBeanMethods() default true;
}
```

#### `@Configuration`

æ ‡è®°ä¸€ä¸ªç±»ä¸ºé…ç½®ç±»

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Component
public @interface Configuration {

    @AliasFor(annotation = Component.class)
    String value() default "";

    boolean proxyBeanMethods() default true;
}
```

### `@EnableAutoConfiguration`

å¯ç”¨ SpringBoot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶

```java
@Target(ElementType.TYPE)
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
@AutoConfigurationPackage
@Import(AutoConfigurationImportSelector.class)
public @interface EnableAutoConfiguration {

    String ENABLED_OVERRIDE_PROPERTY = "spring.boot.enableautoconfiguration";

    Class<?>[] exclude() default {};

    String[] excludeName() default {};
}
```

### `@ComponentScan`

æ‰«æè¢« `@Component`ã€`@Service`ã€`@Controller` æ³¨è§£æ ‡è®°çš„ Beanï¼Œæ³¨è§£é»˜è®¤ä¼šæ‰«æå¯åŠ¨ç±»æ‰€åœ¨çš„åŒ…ä¸‹æ‰€æœ‰çš„ç±»ï¼Œå¯ä»¥è‡ªå®šä¹‰ä¸æ‰«ææŸäº› Bean

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Documented
@Repeatable(ComponentScans.class)
public @interface ComponentScan {

    @AliasFor("basePackages")
    String[] value() default {};

    @AliasFor("value")
    String[] basePackages() default {};

    Class<?>[] basePackageClasses() default {};

    Class<? extends BeanNameGenerator> nameGenerator() default BeanNameGenerator.class;

    Class<? extends ScopeMetadataResolver> scopeResolver() default AnnotationScopeMetadataResolver.class;

    ScopedProxyMode scopedProxy() default ScopedProxyMode.DEFAULT;

    String resourcePattern() default ClassPathScanningCandidateComponentProvider.DEFAULT_RESOURCE_PATTERN;

    boolean useDefaultFilters() default true;

    Filter[] includeFilters() default {};

    Filter[] excludeFilters() default {};

    boolean lazyInit() default false;

    @Retention(RetentionPolicy.RUNTIME)
    @Target({})
    @interface Filter {

        FilterType type() default FilterType.ANNOTATION;

        @AliasFor("classes")
        Class<?>[] value() default {};

        @AliasFor("value")
        Class<?>[] classes() default {};

        String[] pattern() default {};
    }
}
```

## è‡ªåŠ¨é…ç½®

é€šè¿‡æ³¨è§£æˆ–è€…ä¸€äº›ç®€å•çš„é…ç½®å°±èƒ½åœ¨ Spring Boot çš„å¸®åŠ©ä¸‹å®ç°æŸå—åŠŸèƒ½

`@EnableAutoConfiguration` æ³¨è§£ä¸­å¼•å…¥çš„ **AutoConfigurationImportSelector** å°±æ˜¯è‡ªåŠ¨é…ç½®å®ç°çš„æ ¸å¿ƒ

```java
public class AutoConfigurationImportSelector implements DeferredImportSelector, BeanClassLoaderAware,
        ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered {

    protected AutoConfigurationEntry getAutoConfigurationEntry(AnnotationMetadata annotationMetadata) {
        // åˆ¤æ–­æ˜¯å¦å¼€å¯äº†è‡ªåŠ¨è£…é…
        if (!isEnabled(annotationMetadata)) {
            return EMPTY_ENTRY;
        }
        
        // è·å–æ³¨è§£å±æ€§
        AnnotationAttributes attributes = getAttributes(annotationMetadata);

        // è·å–éœ€è¦è‡ªåŠ¨è£…é…çš„æ‰€æœ‰é…ç½®ç±»
        // è¯»å–META-INF/spring.factoriesï¼Œè·å–è‡ªåŠ¨é…ç½®ç±»è·¯å¾„
        List<String> configurations = getCandidateConfigurations(annotationMetadata, attributes);

        // å»é‡
        configurations = removeDuplicates(configurations);

        // å¤„ç†éœ€è¦æ’é™¤çš„é…ç½®ï¼Œåœ¨@EnableAutoConfigurationä¸­å®šä¹‰
        Set<String> exclusions = getExclusions(annotationMetadata, attributes);
        checkExcludedClasses(configurations, exclusions);
        configurations.removeAll(exclusions);

        // ç­›é€‰æ»¡è¶³@ConditionalOn*æ³¨è§£æ¡ä»¶
        // ä¸æ»¡è¶³æ¡ä»¶åˆ™ä¸ä¼šè£…é…
        configurations = getConfigurationClassFilter().filter(configurations);
        fireAutoConfigurationImportEvents(configurations, exclusions);
        return new AutoConfigurationEntry(configurations, exclusions);
    }

    ...

}
```

## é…ç½®æ–‡ä»¶

Spring Boot æ”¯æŒä¸¤ç§é…ç½®æ–‡ä»¶æ ¼å¼ï¼šyaml ä¸ properties

æ€»ä½“æ¥è¯´ï¼ŒäºŒè€…åœ¨æ€§èƒ½ä¸Šæ²¡æœ‰æ˜æ˜¾çš„å·®å¼‚ï¼Œyaml çš„ç»“æ„å±‚æ¬¡æ›´æ¸…æ™°äº›ï¼Œé…ç½®æ•°ç»„æ—¶æ›´æ–¹ä¾¿äº›ï¼Œä½†ä¸æ”¯æŒ `@PropertySource` æ³¨è§£å¯¼å…¥è‡ªå®šä¹‰é…ç½®

- ç›¸åŒç›®å½•ä¸‹ properties æ ¼å¼çš„é…ç½®æ–‡ä»¶çš„åŠ è½½ä¼˜å…ˆçº§æ›´é«˜

```properties
fuck.you[0]="one"
fuck.you[1]="two"
```

```yaml
fuck:
  you:
    - "one"
    - "two"
```

### è¯»å–è‡ªå®šä¹‰é…ç½®

```yaml
fuck:
  you: å¥½çš„
```

#### `@Value`

```java
@Value("${fuck.you}")
String saySomething;
```

#### `@ConfigurationProperties`

```java
@ConfigurationProperties(prefix = "fuck")
public class SaySomething {

    private String you;

    public String say() {
        return you;
    }
}
```

#### `@PropertySource`

è¯»å–æŒ‡å®šçš„ properties æ–‡ä»¶

```properties
fuck.you=deep dark fantasy
```

```java
@PropertySource("classpath:application.properties")
@Component
public class SaySomething {

    @Value("${fuck.you}")
    private String fuckYou;

    public String say() {
        return fuckYou;
    }
}
```

## è‡ªå®šä¹‰ Spring Boot Starter

### å¼•å…¥ä¾èµ–

```xml
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-configuration-processor</artifactId>
    <optional>true</optional>
</dependency>
```

### å‘½å

- å®˜æ–¹å®šä¹‰ starter çš„å‘½åè§„åˆ™ï¼š`spring-boot-starter-*`
- è‡ªå®šä¹‰ starter å‘½åè§„åˆ™ï¼š`*-spring-boot-starter`

### åŠŸèƒ½å®ç°

```java
@Data
// @Component
@ConfigurationProperties(prefix = "hello")
public class SaySomething {

    private String word;

    public String say() {
        return "ä½ è¯´ä»€ä¹ˆï¼š" + word;
    }
}
```

- å¯ä»¥ä¸åŠ  `@Component` æ³¨è§£ï¼Œä½†é…ç½®ç±»éœ€åŠ  `@EnableConfigurationProperties` æ³¨è§£
- åŒç†åŠ äº† `@Component` æ³¨è§£ï¼Œé…ç½®ç±»å¯ä»¥ä¸åŠ  `@EnableConfigurationProperties` æ³¨è§£

å¦‚æœä¸éœ€è¦ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œæ·»åŠ å®Œ `@Component` æ³¨è§£å³å¯

### é…ç½®ç±»

```java
@Configuration
@EnableConfigurationProperties(value = SaySomething.class)
public class MyConfiguration {
}
```

### é…ç½®æ–‡ä»¶

éœ€åœ¨ resources æ–‡ä»¶å¤¹ä¸‹åˆ›å»º META-INF ç›®å½•ï¼Œå¹¶æ–°å»º spring.factories æ–‡ä»¶

```properties
org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.test.config.MyConfiguration
```

### æ‰“åŒ…

è¿è¡Œ `mvn install`

### ä½¿ç”¨

- å¼•å…¥ä¾èµ–

```xml
<dependency>
    <groupId>com.example</groupId>
    <artifactId>mystarter-spring-boot-starter</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
```

- æ·»åŠ é…ç½®

```java
hello:
  world: æˆ‘æ˜¯ä½ å¤§çˆ·
```

ä¹‹åå³å¯ä½¿ç”¨äº†

```java
@Service
public class Test {

    @Autowired
    private SaySomething saySomething;

    public String test() {
        return saySomething.say();
    }
}
```

> æˆ‘æ˜¯ä½ å¤§çˆ·

## å…¨å±€å¼‚å¸¸å¤„ç†

Spring Boot å¯ä»¥é€šè¿‡ `@RestControllerAdvice` å’Œ `@ExceptionHandler` å®ç°å…¨å±€ç»Ÿä¸€å¼‚å¸¸å¤„ç†

```java
@RestControllerAdvice
public class GlobalHandler {

    @ExceptionHandler(Exception.class)
    public String handler(Exception e) {
        System.out.println("å‡ºç°å¼‚å¸¸äº†" + e.getMessage());
        return e.getMessage();
    }
}
```

`@RestControllerAdvice` å…¶å®æ˜¯ `@ControllerAdvice` ä¸ `@ResponseBody` çš„ç»„åˆ

`@ControllerAdvice` ä»åå­—ä¹Ÿå¯çŸ¥é“è¿™æ˜¯ä¸ªç”¨äºå¢å¼º Controller çš„æ³¨è§£ï¼Œä¸ `@ExceptionHandler` æ­é…å°±å¯ä»¥æ•è·æŒ‡å®šçš„å¼‚å¸¸

## å‚è€ƒ

- [çº¦å®šä¼˜äºé…ç½®](https://zh.wikipedia.org/zh-cn/%E7%BA%A6%E5%AE%9A%E4%BC%98%E4%BA%8E%E9%85%8D%E7%BD%AE)
- [å¦‚ä½•ç†è§£ Spring Boot ä¸­çš„çº¦å®šä¼˜äºé…ç½®](https://juejin.cn/post/7024854083223683085)
- [ä¸€æ–‡ææ‡‚ğŸ”¥SpringBootè‡ªåŠ¨é…ç½®åŸç†](https://juejin.cn/post/7046554366068654094)
- [application.yml vs application.properties for Spring Boot](https://stackoverflow.com/questions/47462950/application-yml-vs-application-properties-for-spring-boot)
- [Externalized Configuration](https://docs.spring.io/spring-boot/reference/features/external-config.html)
- [æµ…æPropertySource åŸºæœ¬ä½¿ç”¨](https://blog.csdn.net/qq_36894974/article/details/90237628)
- [SpringBootä¸­@ControllerAdviceç»“åˆ@InitBinderã€@ModelAttributeã€@ExceptionHandlerçš„ä½¿ç”¨](https://blog.csdn.net/backbug/article/details/105317630)
- [Spring Booté¡¹ç›®ä¼˜é›…çš„å…¨å±€å¼‚å¸¸å¤„ç†æ–¹å¼ï¼ˆå…¨ç½‘æœ€æ–°ï¼‰](https://juejin.cn/post/6959520793063587848)
