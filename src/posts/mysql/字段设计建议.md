---
date: 2024-12-04
category:
  - 数据库
tag:
  - MySQL
  - 索引
excerpt: 字段设计建议
order: 99
---

# 字段设计建议

## 必备的字段

主键、创建时间、修改时间

## 应使用适合的最小的数据类型

数据类型越小，占用的空间也就越少，一个数据页就能存放更多的记录，可以有效的减少磁盘 IO 带来的性能损耗，也能把更多的数据页缓存在内存中，加快读写效率

特别是主键列，因为聚簇索引、二级索引都会存储主键值，使用更小的数据类型，意味着节省更多的存储空间和更高效的 IO

## 不应存储过大的数据

占用的空间大，势必会影响数据库的性能，如需存储应当考虑使用对象存储

### 不要使用 blob 和 text 类型

- 占用的空间大，传输时还会消耗大量的网络和 IO 带宽
- 无法设置默认值
- 查询效率低
- 不能直接创建索引，需要指定前缀长度
- 在使用临时表时无法使用内存临时表，只能在磁盘上创建临时表

## 使用 `UNSIGNED`

对于一些不可能为负数的数据，可以将字段设置为 `UNSIGNED`，这样就可以多出一倍的空间

## 日期类型不要使用字符串

- 字符串占用的空间更大
- 字符串存储的日期效率比较低（逐个字符进行比对），无法用日期相关的函数进行计算和比较

应当使用 datetime 或 timestamp，也可以考虑使用 int 或者 bigint 类型来保存时间戳，但可读性较差

## 字段应保证 `NOT NULL`

- 使用空字符 `''` 的长度是 0，是不占用空间的，而 NULL 需要额外的空间（NULL 值标识）对其进行标记
- NULL 值过多会影响索引的查询效率
- 进行比较和计算时要对 NULL 值做特别的处理

## 应使用自定义的有序主键

如果没有自定义的主键，InnoDB 会使用隐藏列 row_id 作为主键

- row_id 会占用 6 个字节，而自定义的主键使用 int 类型的话只占 4 个字节
- 生成 row_id 可能会产生锁竞争，影响性能

并且建议使用有序主键，以避免乱序插入时可能会发生的页分裂和随机 IO

## 参考

- [MySQL 是怎样运行的：从根儿上理解 MySQL](https://juejin.cn/book/6844733769996304392)
- 《高性能MySQL（第4版）》
- [MySQL高性能优化规范建议总结](https://javaguide.cn/database/mysql/mysql-high-performance-optimization-specification-recommendations.html)
